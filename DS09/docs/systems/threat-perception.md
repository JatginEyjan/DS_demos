# 威胁感知系统

> 信息是生存的第一要素，但在这个深渊中，信息本身就是扭曲的。

---

## 设计意图

### 解决什么问题？
- **扫雷的精确数字**让玩家感觉"掌控一切"，削弱了恐怖感
- **完全随机**又会让玩家感到无力，失去推理乐趣
- 需要一种**"可控的未知"**——玩家能推理，但无法100%确定

### 创造什么体验？
- **紧张感**：知道有危险，但不知道具体在哪
- **推理快感**：通过线索组合（底色+👁️）成功预判的成就感
- **不确定性**：即使有线索，最终还是要"赌一把"

### 支撑什么情感？
- **克苏鲁式的不可知**：信息永远不完全
- **调查员的无力**：推理能力有限，无法穷尽所有可能性

---

## 核心规则

### 威胁计算（简化版扫雷）

```
威胁数 = 周围8格中（陷阱 + 剧情房）的总数

注意：所有"雷"（陷阱和剧情房）都计为1，不区分类型
```

**为什么简化？**
- DS08的复杂计算（陷阱+主线×10+支线×-1）让玩家忙于计算而非感受
- 简化后，玩家专注于"有没有危险"而非"是什么类型的危险"
- 更符合"不可名状"——你知道有东西，但不知道是什么

### 风险等级显示

| 威胁数 | 显示 | 底色 | 边框 | 玩家感知 |
|-------|------|------|------|---------|
| 0 | 空白或无 | 🟢 安全绿 | 无 | "这里是安全的，可以连锁展开" |
| 1-2 | 可能显示👁️ | 🟡 不安黄 | 无 | "附近有东西，但不太危险" |
| 3+ | 可能显示👁️ | 🔴 危险红 | 无 | "很危险，大概率有陷阱或剧情房" |

**为什么是3档？**
- 0 = 明确安全（爽点，连锁揭示）
- 1-2 = 模糊警告（需要推理）
- 3+ = 明确警告（高风险高回报）

### 👁️ 注视提示（剧情房暗示）

**触发条件：**
- 格子周围8格中有**任意剧情房**（主线或支线）
- 无论威胁等级是多少，都显示👁️

**为什么这样设计？**
- 👁️既是**诱惑**（可能有剧情/奖励）也是**警告**（可能有危险）
- 符合克苏鲁"被注视"的主题
- 创造决策点：👁️+🔴 = "高风险但可能有高回报，去不去？"

**实现状态：** ✅ 已实现基础功能
**当前缺口（未实现）：**
- 👁️只有一种等级，无法区分"附近有小剧情"和"附近有关键剧情" ❌
- 是否应该有👁️/✨/🔮三级提示？ ❌

---

## 幻觉模式（威胁感知的崩溃）

### 触发条件
- 理智值 < 30

### 效果
- 威胁底色可能**显示错误** ✅
- 具体错误率：30%概率显示错误等级（随机显示为安全/不安/危险） ✅

### 设计意图
- **信息不再可信**：即使是已揭示的格子，也可能在欺骗你 ✅
- **强化疯狂感**：不是界面特效，而是核心机制被影响 ⚠️
- **逼迫决策**：当信息不可靠时，你还敢不敢继续？ ✅

### 实现状态与缺口

| 功能 | 状态 | 说明 |
|-----|------|------|
| 底色错误显示 | ✅ | 已实现，30%错误率 |
| 界面扭曲效果 | ✅ | 已实现，边框变色+抖动 |
| 幻觉叙事文本 | ❌ | 未实现，仅有视觉效果 |
| 👁️提示受幻觉影响 | ❌ | 未实现 |
| 扫描结果受幻觉影响 | ❌ | 未实现 |
| 渐进式幻觉强度 | ❌ | 未实现（当前统一30%）|
| 幻觉后遗症 | ❌ | 未实现 |

### 待办缺口

| 缺口 | 严重程度 | 可能方案 | 状态 |
|-----|---------|---------|------|
| 幻觉只有视觉欺骗，缺少叙事支撑 | 🔴 高 | 幻觉时触发专属剧情文本（"你看到了不存在的东西"） | ❌ |
| 幻觉影响范围太小 | 🟡 中 | 幻觉时👁️提示也可能错误？精神扫描结果也可能错误？ | ❌ |
| 幻觉没有渐进性 | 🟡 中 | 理智20和理智10应该有不同的幻觉强度？ | ❌ |
| 幻觉结束太突兀 | 🟢 低 | 恢复理智后是否应该有"后遗症"（短暂的信息延迟）？ | ❌ |

---

## 关键数值

### 威胁等级阈值
```javascript
if (threatCount === 0) → safe（绿色）
if (threatCount <= 2) → yellow（黄色）
if (threatCount >= 3) → red（红色）
```

**是否需要调整？**
- 当前在6×6网格中，3+威胁的格子占比约15-20%
- 是否需要根据层数调整？（深层更危险？）

### 👁️ 提示概率
- 当前：周围有剧情房就100%显示👁️
- 是否需要根据距离调整？（剧情房在角落时提示弱化？）

### 幻觉错误率
- 当前：30%
- 是否需要根据理智值动态调整？（越低错误率越高？）

---

## 实现状态清单

### ✅ 已实现
- [x] 简化的威胁计算（纯计数）
- [x] 三档风险底色（🟢🟡🔴）
- [x] 👁️注视提示（周围有剧情房时显示）
- [x] 幻觉模式基础（底色可能错误显示，30%错误率）
- [x] 0威胁自动连锁揭示

### ⚠️ 部分实现
- [ ] 幻觉叙事支撑（仅有视觉效果，缺少文本）

### ❌ 未实现 / 待办

#### 🔴 P0 - 影响核心体验
1. **幻觉的叙事支撑**：幻觉时触发专属剧情文本
2. **👁️提示分级**：不同等级的剧情房有不同强度提示（👁️→✨→🔮）
3. **幻觉渐进性**：理智越低，幻觉影响越严重（当前统一30%）
4. **幻觉影响扩展**：👁️提示、精神扫描结果也受幻觉影响

#### 🟡 P1 - 增强体验
5. **威胁等级动态调整**：深层地牢更危险
6. **幻觉后遗症**：恢复理智后短暂信息延迟

#### 🟢 P2 - 探索性
7. **自定义幻觉**：主动进入幻觉换取能力
8. **威胁底色的视觉多样性**：同一等级细微变化

---

## 迭代记录

| 日期 | 改动 | 原因 | 验证结果 | 关联决策 |
|------|------|------|----------|----------|
| 2026-02-13 | 数字→风险底色 | 精确计算削弱恐怖感 | ✅ 有效，玩家需要推理但无法精确计算 | 从DS08演进的核心决策 |
| 2026-02-13 | 简化威胁计算 | 让玩家专注于"有没有危险"而非"是什么" | ✅ 有效，更符合不可名状主题 | 配合底色系统的简化 |
| 2026-02-13 | 添加👁️提示 | 创造"诱惑+警告"的决策点 | ⚠️ 有效但单一，需要分级 | 后续考虑三级提示 |
| 2026-02-13 | 幻觉模式 | 信息不再可信，强化疯狂感 | ⚠️ 只有视觉欺骗，缺少叙事支撑 | 下一步重点：幻觉剧情 |

---

## 关联系统

- **精神扫描系统**：扫描可以绕过威胁感知，直接知道真相
- **理智系统**：理智<30触发幻觉，威胁感知被扭曲
- **撤离系统**：威胁感知的信息质量影响撤离决策

---

## 设计原则总结

1. **模糊优于精确**：🟡"不安"比"周围有2个陷阱"更有恐怖感
2. **诱惑与警告并存**：👁️既是邀请也是警告
3. **信息即资源**：在幻觉中，信息本身成为稀缺资源
4. **可控的未知**：玩家能推理，但无法穷尽，最终必须做出选择

---

*最后更新：2026-02-14*  
*状态：核心功能完成，幻觉叙事支撑待完善*