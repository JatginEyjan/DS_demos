# 撤离抉择系统

> 最艰难的从不是面对怪物，而是决定何时转身离开。

---

## 设计意图

### 解决什么问题？
- **扫雷的确定性**：一旦开始就必须解完，缺少"退出权"
- **Roguelike的永久性死亡**：太残酷，挫败感强
- **需要一种"阶段性退出"**：让玩家有掌控感，但退出有代价

### 创造什么体验？
- **贪婪与恐惧的拉扯**："再探索一格"vs"现在就走"
- **风险计算**：评估当前状态能否支撑更多探索
- **后悔与庆幸**：撤离后的复盘（"幸好走了"或"应该再贪一波"）

### 支撑什么情感？
- **生存本能**：在贪婪中保持一丝理智
- **代价意识**：没有免费的午餐，探索越多风险越大
- **赌徒心理**："就再赌一把"的诱惑

---

## 核心规则

### 撤离解锁条件

```
探索步数 ≥ 层数要求的步数

第1层：8步
第2层：15步
第3层：20步
第4层：30步
第5层：40步（BOSS层）
```

**为什么是步数而非地图完成度？**
- 步数 = 玩家的主动选择（每一步都是赌）
- 地图完成度 = 被动扫图
- 步数更能体现"贪婪程度"

### 撤离时的选择

**选项A：立即撤离** ✅
- 安全带走全部已获资源（金币、道具、情报）
- 理智恢复到100（或固定值）
- 进入下一层（或结局）

**选项B：继续探索** ⚠️
- 保留当前状态（理智不恢复）
- 可以继续探索，获得更多资源
- **但无法再次撤离**，直到...？

**当前缺口：继续探索后的退出机制**
- 目前"继续探索"后没有明确的二次退出点
- 玩家可能陷入"一直贪一直贪"直到理智崩溃
- 是否应该允许"超额探索后再撤离"，但有惩罚？

### 收益机制（当前线性）

```
当前收益 = 基础探索收益 + 剧情房奖励 + 道具价值

撤离时：获得100%收益
死亡时：失去副本内获得的所有收益
```

**为什么是线性？**
- 简单直观
- 但缺少"贪婪的指数回报"诱惑

**缺口：非线性收益**
- 如果超额探索的收益指数增长，会不会增强贪婪的诱惑？
- 例如：基础收益×(1 + 超额步数/10)
- 风险：收益指数增长，但理智消耗也指数增长？

---

## 关键数值

### 步数要求（当前）

| 层数 | 要求步数 | 地图大小 | 陷阱数 | 密度 |
|-----|---------|---------|-------|------|
| 1 | 8 | 6×6 | 3 | ~8% |
| 2 | 15 | 9×9 | 6 | ~7% |
| 3 | 20 | 10×10 | 8 | ~8% |
| 4 | 30 | 12×12 | 12 | ~8% |
| 5 | 40 | 14×14 | 15 | ~8% |

**观察：**
- 步数要求 ≈ 地图可探索区域的30-40%
- 陷阱密度保持在7-8%
- 是否需要动态调整？（玩家表现好则下一层更难？）

### 缺口：难度曲线

**当前问题（从愿景文档提升为高优先级）：**
- 难度太平缓，容错率过高
- 随机体验无有效反馈
- 无法进入心流体验

**可能方案：**
1. **动态难度**：根据玩家前一层的表现调整下一层
2. **关键节点强制挑战**：某些格子必须踩，不能绕过
3. **陷阱密度递增**：深层更危险
4. **步数要求弹性**：表现好则要求高，表现差则要求低？

---

## 当前实现

### 已实现
- [x] 步数要求的撤离解锁
- [x] 撤离/继续探索的二选一
- [x] 撤离后资源结算
- [x] 进入下一层/结局

### 实验中
- [ ] 无明确实验

### 待办（按优先级）

#### 🔴 P0 - 影响核心体验（难度曲线）
1. **动态难度调整**：根据玩家表现调整下一层参数
2. **非线性收益**：超额探索的指数回报诱惑
3. **二次退出机制**：继续探索后如何再次撤离？

#### 🟡 P1 - 增强体验
4. **撤离的叙事代价**：成功撤离但留下精神创伤（叙事描述）
5. **层间关联**：撤离时是否可以保留某些"记忆"影响下一层？
6. **紧急撤离**：极低理智时是否可以"狼狈逃跑"（损失部分资源）？

#### 🟢 P2 - 探索性
7. **主动挑战**：玩家可以选择增加难度换取更高收益？
8. **撤离倒计时**：达标后倒计时，强迫快速决策？

---

## 迭代记录

| 日期 | 改动 | 原因 | 验证结果 | 关联决策 |
|------|------|------|----------|----------|
| 2026-02-13 | 步数要求撤离 | 给玩家明确的"退出权" | ✅ 有效，创造了抉择点 | 核心机制 |
| 2026-02-13 | 继续探索选项 | 允许贪婪，增加张力 | ⚠️ 有效但缺少二次退出机制 | 需要完善 |
| 2026-02-14 | （待做）动态难度 | 当前难度太平缓 | 🔄 待验证 | 高优先级缺口 |

---

## 关联系统

- **威胁感知系统**：信息质量影响"能否继续探索"的判断
- **理智系统**：理智值是"能否继续探索"的硬性限制
- **叙事系统**：撤离应该有不同的叙事描述（安全撤离vs狼狈逃跑）

---

## 设计原则总结

1. **退出权是掌控感的来源**：玩家必须感觉"我可以选择离开"
2. **贪婪必须有代价**：继续探索的收益必须伴随明确的风险
3. **没有完美的时机**：任何时候撤离都可能后悔，任何时候贪婪都可能崩溃
4. **阶段性而非永久性**：层间继承降低挫败感，但每次撤离都是一次"小结算"

---

*最后更新：2026-02-14*  
*状态：核心功能完成，难度曲线和非线性收益待完善*