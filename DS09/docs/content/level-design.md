# 关卡设计内容文档

> 每一层都是深渊对你的一次测试，也是你对自己人性的一次考验。

---

## 关卡设计总览

### 设计目标

1. **渐进难度**：从教学到挑战，让玩家逐渐掌握系统
2. **情感映射**：每层对应玩家心理变化的阶段
3. **叙事融合**：关卡设计服务于故事，环境讲述历史
4. **可控随机**：随机生成但保证体验一致性

### 五层结构

| 层级 | 名称 | 情感主题 | 难度定位 | 核心机制 |
|-----|------|---------|---------|---------|
| L1 | 表层遗迹 | 好奇·初次接触 | 教学+探索 | 基础扫雷、首次剧情 |
| L2 | 低语回廊 | 不安·被注视 | 初级挑战 | 低语机制、前辈痕迹 |
| L3 | 蛇人神殿 | 恐惧·面对真相 | 中级挑战 | 幻觉开始出现、核心剧情 |
| L4 | 时间裂隙 | 执念·迷失自我 | 高级挑战 | 时间错乱、理智高压 |
| L5 | 深渊祭坛 | 抉择·终极考验 | 终极挑战 | 最终Boss、多结局 |

---

## 难度控制手段

### 1. 密度控制（陷阱密度）

```javascript
// 陷阱密度 = 陷阱数 / 总格子数
L1: 6×6=36格, 3陷阱 → 8.3%
L2: 9×9=81格, 6陷阱 → 7.4%
L3: 10×10=100格, 8陷阱 → 8.0%
L4: 12×12=144格, 12陷阱 → 8.3%
L5: 14×14=196格, 15陷阱 → 7.7%
```

**问题：** 密度几乎持平，没有难度递进感 ❌

**改进方案：**
```javascript
// 密度随层数递增
L1: 6×6=36格, 2陷阱 → 5.6% (教学，容错高)
L2: 9×9=81格, 5陷阱 → 6.2% (初级)
L3: 10×10=100格, 9陷阱 → 9.0% (中级，跳跃提升)
L4: 12×12=144格, 14陷阱 → 9.7% (高级)
L5: 14×14=196格, 22陷阱 → 11.2% (终极挑战)
```

**密度控制的其他手段：**
- **聚集度**：后期层陷阱更聚集（减少安全区域）
- **边缘陷阱**：后期层陷阱更靠近边缘（限制移动空间）
- **剧情房邻近**：后期层陷阱更靠近剧情房（增加探索风险）

---

### 2. 数值控制（理智压力）

**当前数值（问题）：**
| 场景 | L1-L5统一 |
|-----|----------|
| 踩陷阱 | -15~25 |
| 剧情失败 | -10~-20 |

**改进方案（层数递进）：**

```javascript
// 理智伤害随层数递增
const sanityDamage = {
  trap: {
    L1: 10~15,    // 轻微警告
    L2: 12~18,    // 开始紧张
    L3: 15~22,    // 明显压力
    L4: 18~28,    // 高压
    L5: 20~35     // 致命
  },
  storyFail: {
    L1: 8~12,
    L2: 10~15,
    L3: 12~20,
    L4: 15~25,
    L5: 18~30
  }
};
```

**数值控制的其他手段：**
- **理智恢复减少**：深层理智药水效果-20%/-40%
- **自然流失**：L4-L5每5步流失1点理智（环境压迫）
- **幻觉阈值降低**：L1-L2: <30, L3-L4: <35, L5: <40

---

### 3. 步数控制（撤离压力）

**当前数值（问题）：**
| 层数 | 要求步数 | 地图大小 | 比例 |
|-----|---------|---------|------|
| L1 | 8 | 6×6=36 | 22% |
| L2 | 15 | 9×9=81 | 19% |
| L3 | 20 | 10×10=100 | 20% |
| L4 | 30 | 12×12=144 | 21% |
| L5 | 40 | 14×14=196 | 20% |

**问题：** 比例几乎一致，没有递进 ❌

**改进方案：**
```javascript
// 撤离难度递进
const extractionSteps = {
  L1: 6,   // 6×6=36, 17% (宽松，教学)
  L2: 12,  // 9×9=81, 15% (略紧)
  L3: 18,  // 10×10=100, 18% (但陷阱密度提升)
  L4: 28,  // 12×12=144, 19% (高压)
  L5: 45   // 14×14=196, 23% (但陷阱密度极高)
};

// 关键改动：L5的"超额收益"机制
// 达到45步后可撤离，但每多5步收益×1.5
// 创造"贪婪陷阱"
```

---

### 4. 资源控制（稀缺性）

**精神力控制：**
```javascript
// 每层初始精神力
L1: 5  // 教学，充足
L2: 4  // 开始限制
L3: 3  // 紧张
L4: 3  // 高压（但地图更大）
L5: 2  // 极度稀缺
```

**道具获取控制：**
```javascript
// 商店道具数量
L1: 4功能+1剧情  // 丰富
L2: 3功能+1剧情
L3: 3功能+0剧情  // 剧情道具减少，增加探索动力
L4: 2功能+0剧情
L5: 2功能+1特殊 // 最后的补给点
```

**关键道具分布：**
- L1: 古老钥匙（主线必需）
- L2: 奴隶地图（实用）
- L3: 神秘卷轴（高风险高回报）
- L4: 无（资源枯竭，增加绝望感）
- L5: 特殊道具（根据前期选择决定）

---

### 5. 环境控制（叙事压力）

**视觉压迫：**
```javascript
// 地图色调随层数变化
L1: 明亮褐色（遗迹表层）
L2: 暗绿（潮湿回廊）
L3: 暗紫（神殿氛围）
L4: 暗红（时间裂隙）
L5: 黑白+血色（深渊祭坛）
```

**UI压迫：**
```javascript
// 理智值UI变化
L1-L2: 正常数字
L3: 数字边缘模糊
L4: 数字偶尔抖动
L5: 数字有血迹效果
```

**音效压迫：**
```javascript
// 环境音效
L1: 风声、滴水声
L2: 低语声（偶尔）
L3: 持续低语+心跳声
L4: 时间错位音效（回声、倒放）
L5: 几乎寂静，偶尔巨响
```

---

### 6. 动态难度（玩家自适应）

**当前缺失：** 难度固定，不会根据玩家表现调整 ❌

**实现方案：**
```javascript
// 根据上一层表现调整当前层
function adjustDifficulty(playerStats) {
  const { 
    averageSanity,      // 平均理智值
    trapAvoidanceRate,  // 陷阱规避率
    storySuccessRate,   // 剧情成功率
    extractionGreed     // 超额探索率
  } = playerStats;
  
  let modifier = 0;
  
  // 表现好 → 增加难度
  if (averageSanity > 70) modifier += 0.1;
  if (trapAvoidanceRate > 0.6) modifier += 0.05;
  if (storySuccessRate > 0.7) modifier += 0.1;
  
  // 表现差 → 降低难度（但有限）
  if (averageSanity < 40) modifier -= 0.05;
  if (trapAvoidanceRate < 0.3) modifier -= 0.05;
  
  return modifier; // -0.1 ~ +0.25
}

// 应用：陷阱密度 × (1 + modifier)
```

**动态难度的好处：**
- 高手玩家获得挑战
- 新手玩家不被劝退
- 保持"刚刚好"的心流体验

---

## 每层详细设计

### 第1层：表层遗迹（教学层）

**目标：** 让玩家理解基础机制，建立自信

**难度参数：**
```javascript
{
  size: 6,
  traps: 2,           // 低密度 5.6%
  stories: 3,         // 丰富剧情
  extractionSteps: 6, // 宽松
  markers: 5,         // 充足精神力
  hallucination: false // 无幻觉
}
```

**布局策略：**
- 起始区域：安全区（0威胁），让玩家熟悉点击
- 陷阱位置：远离起始区，给玩家反应时间
- 剧情房：必经之路上，确保玩家体验剧情
- 撤离点：中心位置，容易到达

**叙事元素：**
- 环境：老宅地窖、破损墙壁、阳光透入（最后的"正常"）
- 剧情：发现蛇人文明、获得古老钥匙
- 前辈痕迹：骸骨堆（第一次接触死亡）

**教学点：**
1. 点击揭示
2. 威胁底色含义
3. 连锁揭示爽感
4. 剧情房触发
5. 撤离机制

---

### 第2层：低语回廊（压力层）

**目标：** 引入压力机制，开始不安

**难度参数：**
```javascript
{
  size: 9,
  traps: 5,           // 密度 6.2%
  stories: 3,
  extractionSteps: 12,
  markers: 4,
  hallucination: false,
  special: 'whispers' // 低语机制
}
```

**布局策略：**
- 狭长回廊结构（增加线性压迫感）
- 陷阱分布：中间密集，边缘安全
- 剧情房：分布在陷阱附近（诱惑+警告）

**特殊机制：低语**
```javascript
// 随机事件：低语
// 触发：随机，或玩家停留过久
// 效果：玩家听到声音，但没有实际危险
// 目的：制造不安，消耗理智（-3）
```

**叙事元素：**
- 环境：狭窄隧道、潮湿墙壁、忽明忽暗的灯光
- 剧情：低语回廊、奴隶牢房
- 前辈痕迹：活着的疯子（第23名调查员）

**情感目标：** 从好奇转向不安

---

### 第3层：蛇人神殿（转折层）

**目标：** 引入幻觉机制，难度跳跃

**难度参数：**
```javascript
{
  size: 10,
  traps: 9,           // 密度跳跃到 9.0%
  stories: 2,         // 减少，增加探索动力
  extractionSteps: 18,
  markers: 3,         // 限制资源
  hallucination: true, // 开启幻觉
  hallucinationThreshold: 35 // 阈值提高
}
```

**布局策略：**
- 神殿结构：中央大厅+侧室（增加选择）
- 陷阱分布：围绕剧情房（高风险高回报）
- 幻觉触发区：特定区域理智流失加快

**关键剧情房：**
- 蛇人祭司：获得神秘卷轴（理解真相的代价）
- 镜像房间：面对变形的自我

**叙事元素：**
- 环境：蛇人雕像、发光符文、祭坛
- 剧情：理解蛇人目标、面对诱惑
- 转折点：从这里开始，回头路比前进路更难

**情感目标：** 恐惧与执念并存

---

### 第4层：时间裂隙（高压层）

**目标：** 高压测试，资源枯竭

**难度参数：**
```javascript
{
  size: 12,
  traps: 14,          // 密度 9.7%
  stories: 2,         // 极少
  extractionSteps: 28, // 高压
  markers: 3,         // 资源紧张
  hallucination: true,
  hallucinationThreshold: 35,
  special: 'timeLoop', // 时间循环
  naturalSanityDrain: 1 // 每5步流失1理智
}
```

**布局策略：**
- 迷宫结构：多路径、死胡同（增加迷失感）
- 陷阱分布：随机但聚集（无法预测）
- 时间错乱区：特定区域会产生"时间跳跃"（回到之前位置）

**特殊机制：时间错乱**
```javascript
// 触发：踩到特定格子
// 效果：玩家被传送回5步前的位置
// 理智：-10
// 目的：强化"迷失"感
```

**叙事元素：**
- 环境：扭曲的空间、重复的房间、破碎的时钟
- 剧情：时间回廊（遇见自己）
- 无剧情道具：资源枯竭，绝望感

**情感目标：** 执念与迷失

---

### 第5层：深渊祭坛（终极层）

**目标：** 终极考验，多结局

**难度参数：**
```javascript
{
  size: 14,
  traps: 22,          // 密度 11.2%，极高
  stories: 1,         // 只有最终剧情
  extractionSteps: 45, // 高难度撤离
  markers: 2,         // 极度稀缺
  hallucination: true,
  hallucinationThreshold: 40, // 极易触发
  naturalSanityDrain: 1, // 每3步流失1理智
  special: 'finalChoice' // 最终抉择
}
```

**布局策略：**
- 中心放射状：祭坛在中心，路径向外辐射
- 陷阱分布：外围密集，中心相对安全（诱惑深入）
- 唯一剧情房：深渊祭坛（无法回避）

**特殊机制：超额收益**
```javascript
// 达到45步后可撤离
// 但每多探索5步，收益×1.5
// 创造"贪婪陷阱"：想赚更多，但理智在流失
// 最优策略：平衡贪婪与安全
```

**多结局触发：**
```javascript
// 结局判定
if (hasAncientKey && sanity > 20) {
  // 真结局分支
  if (d100Roll <= 50) return 'awakening'; // 觉醒
  else return 'collapse'; // 崩溃
} else if (hasAncientKey && sanity <= 20) {
  return 'collapse'; // 理智不足，强制崩溃
} else {
  return 'survivor'; // 无钥匙，普通结局
}
```

**叙事元素：**
- 环境：深渊祭坛、星空天花板、那扇"门"
- 剧情：最终抉择
- 情感：所有前面积累的情绪爆发

**情感目标：** 疯狂或觉醒的终极抉择

---

## 难度规划总结

### 难度曲线图

```
难度 ↑
     │
100% │                                    ╱──── 终极
     │                              ╱────╱
 75% │                        ╱────╱
     │                  ╱────╱
 50% │            ╱────╱
     │      ╱────╱
 25% │────╱
     │
   0% └────┬────┬────┬────┬────┬────→ 层数
           L1   L2   L3   L4   L5

          教学  初级  中级  高级  终极
          5.6%  6.2%  9.0%  9.7% 11.2%
```

### 难度控制手段优先级

| 优先级 | 手段 | 实现难度 | 效果 |
|-------|------|---------|------|
| 🔴 P0 | 陷阱密度递增 | 低 | 显著 |
| 🔴 P0 | 理智伤害递增 | 低 | 显著 |
| 🔴 P0 | 精神力递减 | 低 | 显著 |
| 🟡 P1 | 动态难度 | 中 | 高（心流） |
| 🟡 P1 | 环境压迫 | 中 | 中（沉浸） |
| 🟢 P2 | 自然理智流失 | 低 | 中（紧张） |

### 待办清单

#### 🔴 立即实现
- [ ] 调整陷阱密度（5.6% → 6.2% → 9.0% → 9.7% → 11.2%）
- [ ] 调整理智伤害（层数递增）
- [ ] 调整精神力（5 → 4 → 3 → 3 → 2）

#### 🟡 近期实现
- [ ] 动态难度系统
- [ ] 环境视觉变化（每层不同色调）
- [ ] L5超额收益机制

#### 🟢 长期规划
- [ ] 自然理智流失（L4-L5）
- [ ] 音效压迫系统
- [ ] 玩家表现数据统计（用于动态难度）

---

*文档版本：1.0*  
*最后更新：2026-02-14*  
*状态：框架完成，具体数值待实施*