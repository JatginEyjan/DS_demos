# DS10 Demo设计文档

> 极简验证：局势对象系统 + 技能检定 + 副本循环

---

## 一、Demo目标

**验证核心假设：**
1. 局势对象联动是否有趣？
2. 技能检定是否有张力？
3. 15-30分钟副本循环是否合理？

**成功标准：**
- 玩家愿意"再试一次不同方法"
- 失败后感到"遗憾"而非"挫败"
- 想尝试不同职业/策略

---

## 二、技术规格

```yaml
平台: H5网页（HTML5 + Canvas/JavaScript）
画面: 2D像素（极简风格）
分辨率: 移动端适配（建议 360x640 竖屏或 640x360 横屏）

控制:
  - 点击选择对象
  - 点击选择行动
  - 简单触控手势（可选）

无音效
无局外系统（纯局内验证）
```

---

## 三、Demo副本设计

### 副本结构（短副本 - 节点选择）

```
【浅层遗迹】（教学副本 - 20分钟）

入口
  ↓
第1层安全屋（恢复点+可撤离）
  ↓
分支选择：
  ├─→ 房间A：储藏室（教学基础）
  └─→ 房间B：陷阱走廊（可选，高风险高回报）
  ↓（完成房间后返回选择点或前往下一层）
第2层安全屋（恢复点+可撤离）
  ↓
房间C：仪式厅（Boss战）
  ↓
撤离/通关

总房间数：2-3个战斗房间 + 2个安全屋
预计时长：15-20分钟
```

### 节点选择系统

**地图界面：**
```
┌────────────────────────────┐
│      【浅层遗迹】           │
│                            │
│    [安全屋1]  ★            │
│       ↓                    │
│   [房间A]──[房间B]         │
│   (已完成) (?)             │
│       ↓                    │
│    [安全屋2]  ★            │
│       ↓                    │
│    [房间C]  ⚠️ BOSS        │
│                            │
│  图例: ★安全屋  ?未探索   │
└────────────────────────────┘
```

**选择机制：**
- 完成一个房间后，可以：
  1. 前往相邻房间（继续探索）
  2. 返回安全屋（恢复+整理）
  3. 前往下一层（如果满足条件）
- 未选择的房间会保留（下次进入副本还在）
- 部分房间可能是"一次性"（进入后坍塌/封锁）

### 安全屋系统

**功能：**
```yaml
安全屋:
  恢复功能:
    - 恢复30% HP（需消耗1食物）
    - 恢复20 SAN（需休息5分钟/现实30秒）
    - 整理背包（丢弃/使用道具）
  
  撤离功能:
    - 随时可以选择撤离副本
    - 带走已获得的所有资源
    - 进度保存（下次从安全屋继续）
  
  情报功能:
    - 查看当前副本地图
    - 标记已发现的陷阱/敌人
    - 记录房间特征（供下次参考）
  
  限制:
    - 每层只有一个安全屋
    - 敌人不会进入安全屋（但可能埋伏在入口）
    - 长时间停留可能引来敌人（可选机制）
```

**安全屋内界面：**
```
┌────────────────────────────┐
│      【第1层安全屋】        │
│                            │
│  状态:                     │
│  HP: 45/70  SAN: 60/80     │
│  时间: 18:30/30:00         │
│                            │
│  可用行动:                 │
│  [🍞 进食恢复] [💤 休息]   │
│  [🎒 整理背包] [🗺️ 查看地图]│
│                            │
│  下一步:                   │
│  [→ 继续探索]              │
│  [🚪 撤离副本]             │
│  [⬇️ 前往第2层]            │
└────────────────────────────┘
```

### 房间1：储藏室（教学）

**画面描述：**
```
┌────────────────────────────┐
│     储藏室 - 第1层          │
│                            │
│   [宝箱]      [门→]        │
│    📦         🚪            │
│    🔒                      │
│                            │
│        [调查员] 👤          │
│                            │
│  理智: 80  时间: 08:30     │
└────────────────────────────┘

像素风格：
- 墙壁：暗色石砖
- 宝箱：棕色木箱+金属锁
- 门：拱形石门，微开
- 调查员：像素小人，持手电筒
```

**对象1：上锁的宝箱**
```yaml
外观: 古老木箱，铜锁
状态: 上锁

可执行行动:
  观察锁:
    检定: 侦查 vs 25
    成功: 发现锁结构简单，开锁难度-10
    失败: 无额外信息
  
  开锁:
    检定: 侦查 vs 35（观察成功后25）
    成功: 获得【旧笔记】（情报+10金币）
    失败: 锁卡住，耗时+2分钟
  
  暴力破坏:
    检定: 力量 vs 30
    成功: 获得内容物，但【旧笔记】损坏（仅金币）
    失败: 箱子太硬，耗时+3分钟

隐藏信息:
  侦查>40: 发现箱子底部有血迹（暗示危险）
```

**教学点：**
- 学会"观察→行动"的基本循环
- 理解技能检定（d100 ≤ 技能值）
- 理解不同路径（开锁vs破坏）

---

### 房间2：守卫室（对象联动教学）

**画面描述：**
```
┌────────────────────────────┐
│     守卫室 - 第1层          │
│                            │
│  [陷阱]      [怪物]         │
│   ⚠️          👹            │
│  毒刺        深潜者         │
│                            │
│         [门→]              │
│          🚪                 │
│                            │
│  [调查员] 👤                │
│                            │
│  理智: 75  时间: 06:45     │
└────────────────────────────┘

像素风格：
- 地面：石板，有裂缝
- 陷阱：地板上的尖刺机关（隐约可见）
- 怪物：绿色像素块，人形，手持武器
- 氛围：比房间1更暗
```

**对象1：地板陷阱**
```yaml
外观: 地板微凸，颜色略深
状态: 待机

可执行行动:
  观察:
    检定: 侦查 vs 30
    成功: 发现陷阱位置，可标记避开
    失败: 未察觉
  
  解除:
    检定: 侦查 vs 40
    成功: 陷阱失效
    失败: 触发陷阱
  
  硬闯:
    结果: 自动触发
    伤害: HP-15，理智-5

被动效果:
  怪物踩到: 怪物HP-20，愤怒状态
```

**对象2：深潜者守卫**
```yaml
外观: 鱼人特征，手持骨刃
状态: 巡逻中
HP: 50

AI行为:
  每回合: 随机移动或原地警戒
  发现玩家: 进入追击状态
  
可执行行动:
  观察:
    检定: 侦查 vs 35
    成功: 发现左腿有伤（战斗时攻击腿部有加成）
  
  潜行绕过:
    检定: 侦查 vs 40
    成功: 直接进入下房间
    失败: 被发现，进入战斗
  
  战斗:
    近战: 格斗 vs 怪物防御
    远程: 射击（如果有枪）
    
  利用陷阱:
    条件: 已发现陷阱
    结果: 引诱怪物踩陷阱（需要站位和时机）
```

**核心联动教学：**
```
最优解发现过程：

第1回合：观察陷阱 → 发现陷阱位置
第2回合：观察怪物 → 发现怪物巡逻路线经过陷阱
第3回合：移动引诱 → 怪物追击你时踩到陷阱
第4回合：趁机攻击 → 怪物受伤+束缚，你有优势

或者：
第1回合：潜行尝试 → 失败被发现
第2-4回合：硬战斗 → 消耗HP和弹药
第5回合：险胜 → 但状态很差

教学点："观察环境→发现联动→最优解"的思维方式
```

---

### 房间C：仪式厅（Boss战，副本终点）

**画面描述：**
```
┌────────────────────────────┐
│     仪式厅 - 第2层 ☠️       │
│                            │
│   [仪式]    [邪教徒]        │
│    🔮         🗣️            │
│   进度30%    施法中         │
│                            │
│  [宝箱]      [柱子]         │
│   📦          🏛️            │
│  被锁        可破坏         │
│                            │
│        [调查员] 👤          │
│                            │
│  理智: 60  时间: 04:30     │
│  ⚠️仪式进度每回合+15%      │
└────────────────────────────┘

像素风格：
- 中央：发光祭坛，符文旋转（动画）
- 邪教徒：黑袍，举手法术姿势
- 宝箱：华丽装饰，明显重要
- 柱子：高像素柱，可互动
- 整体：暗红+紫色色调，压迫感
```

**对象1：召唤仪式**
```yaml
外观: 发光祭坛，旋转符文
状态: 进行中
进度: 30%（每回合+15%）
完成效果: 召唤古神眷属（游戏结束）

可执行行动:
  观察:
    检定: 侦查 vs 35 或 神秘学 vs 30
    成功: 发现"阵眼"水晶（破坏可终止）
    失败: 只知道很危险
  
  干扰:
    检定: 神秘学 vs 40
    成功: 进度-25%，1回合停滞
    失败: 反噬，理智-15
  
  破坏阵眼:
    条件: 必须先观察成功
    检定: 力量 vs 35
    成功: 仪式终止，但能量冲击（所有对象受影响）
    失败: 水晶裂纹，进度-10%
```

**对象2：邪教徒**
```yaml
外观: 黑袍，手持匕首
状态: 专注施法
HP: 40

AI行为:
  专注时: 仪式进度额外+5%
  被打扰: 停止施法，攻击打扰者
  血量<20: 试图逃跑并引爆祭坛

可执行行动:
  刺杀:
    条件: 潜行接近（未被发现）
    检定: 格斗 vs 30
    成功: 即死，但仪式暴走（进度+30%）
  
  远程攻击:
    结果: 打断施法，邪教徒进入战斗
  
  交涉:
    检定: 话术 vs 50（高难度，对方疯狂）
    成功: 暂时说服停止（1回合）
    失败: 对方狂笑，进度+10%
```

**对象3：上锁的宝箱**
```yaml
外观: 华丽金箱，蛇纹装饰
状态: 上锁，魔法保护
内容物: 【古老钥匙】（副本通关必需）+ 金币

特殊:
  仪式完成时: 宝箱被腐蚀，内容物毁灭
  仪式被破坏时: 能量冲击震开锁（自动开启）

可执行行动:
  开锁:
    检定: 侦查 vs 45（高难度）
    成功: 获得内容物
    失败: 触发魔法陷阱，理智-10
```

**对象4：石柱**
```yaml
外观: 承重石柱，有裂纹
状态: 稳定

可执行行动:
  观察:
    检定: 侦查 vs 30
    成功: 发现是承重柱，可破坏改变地形
  
  破坏:
    检定: 力量 vs 40
    成功: 
      - 石柱倒塌，阻挡一侧
      - 邪教徒被困/需要绕路
      - 但出口也可能被堵
    失败: 浪费时间，进度+15%
```

**多解法路径：**

```
路径A：刺客型（最快）
1. 潜行接近邪教徒
2. 刺杀（即死）
3. 仪式暴走，进度+30%
4. 快速破坏阵眼（力量检定）
5. 能量冲击震开宝箱
6. 拿钥匙，撤离

路径B：法师型（安全但耗时）
1. 观察仪式发现阵眼
2. 反复干扰（神秘学）
3. 同时远程攻击邪教徒
4. 邪教徒死，仪式停止
5. 慢慢开锁
6. 拿钥匙，撤离

路径C：战士型（硬碰硬）
1. 直接攻击邪教徒
2. 进入战斗
3. 同时注意仪式进度
4. 邪教徒死后立即破坏阵眼
5. 拿钥匙，撤离

路径D：环境利用型（最巧妙）
1. 观察发现石柱可破坏
2. 引诱邪教徒到石柱旁
3. 破坏石柱，困住邪教徒
4. 安全处理仪式
5. 拿钥匙，撤离

路径E：贪心型（高风险）
1. 无视仪式，直接开锁
2. 成功：拿钥匙，再处理仪式
3. 失败：触发陷阱，状态极差
4. 可能来不及阻止仪式
```

---

## 四、调查员设计

### Demo职业（3选1）

**1. 考古学家（平衡型）**
```yaml
HP: 70
SAN: 80

技能:
  侦查: 50（擅长）
  力量: 30
  神秘学: 35

特质:
  敏锐直觉: 首次观察检定+10%
  考古知识: 宝箱/古老机关检定+10%

装备:
  考古工具: 开锁检定+10%
  手电筒: 视野+1格
  
适合: 观察型、探索型玩家
```

**2. 前军人（战斗型）**
```yaml
HP: 90
SAN: 60

技能:
  侦查: 35
  力量: 55（擅长）
  神秘学: 20

特质:
  战术训练: 战斗检定+10%
  肾上腺素: HP<30时力量+10

装备:
  手枪: 6发弹药，远程攻击
  军刀: 近战武器
  
适合: 直接型、战斗型玩家
```

**3. 神秘学者（专家型）**
```yaml
HP: 50
SAN: 60（较低，危险）

技能:
  侦查: 40
  力量: 20
  神秘学: 55（擅长）

特质:
  魔法感知: 自动看到隐藏魔法对象
  疯狂边缘: SAN<30时神秘学+15，但失控风险

装备:
  护符: SAN损失-10%
  仪式匕首: 神秘学检定+10%
  
适合: 高风险高回报、专家型玩家
```

---

## 五、UI设计（2D像素风格）

### 主界面布局
```
┌─────────────────────────────────────┐
│  理智: ████████░░ 80  时间: 12:30   │  ← 顶部状态栏
├─────────────────────────────────────┤
│                                     │
│     [房间像素画面]                   │  ← 中央画面区
│     对象1    对象2                  │
│     对象3    对象4                  │
│                                     │
│     调查员位置                       │
│                                     │
├─────────────────────────────────────┤
│  请选择行动:                         │  ← 底部操作区
│  [1] 观察仪式   [2] 干扰仪式        │
│  [3] 攻击邪教徒 [4] 移动位置        │
├─────────────────────────────────────┤
│  日志: 你仔细观察祭坛...            │  ← 底部日志区
└─────────────────────────────────────┘
```

### 像素美术风格建议

**色调：**
- 整体：低饱和度，暗色基调
- 安全区域：偏蓝灰
- 危险区域：偏暗红
- 可交互对象：微发光，吸引注意

**对象辨识度：**
- 宝箱：棕色+金色锁（重要感）
- 怪物：深色+红色眼睛（威胁感）
- 仪式：紫色光效+旋转动画（神秘感）
- 陷阱：暗色+微凸（需要仔细观察）

**动画：**
- 仪式：符文旋转
- 怪物：呼吸起伏
- 调查员：手电筒摇摆（如果有）
- 选中对象：边框高亮

---

## 六、技术实现要点

### 核心数据结构

```javascript
// 调查员
const investigator = {
  name: "李雷",
  profession: "archaeologist",
  hp: 70, maxHp: 70,
  sanity: 80, maxSanity: 80,
  skills: {
   侦查: 50,
    力量: 30,
    神秘学: 35
  },
  traits: ["敏锐直觉", "考古知识"],
  equipment: ["考古工具", "手电筒"]
};

// 房间
const room = {
  name: "仪式厅",
  objects: [ritual, cultist, chest, pillar],
  exits: ["撤离", "下一层"]
};

// 对象
const ritual = {
  id: "summoning_ritual",
  name: "召唤仪式",
  type: "progress",
  state: {
    progress: 30,
    increasePerTurn: 15
  },
  actions: [observe, disrupt, destroyCrystal]
};

// 检定
function skillCheck(skillValue, difficulty) {
  const roll = Math.floor(Math.random() * 100) + 1;
  // 大成功/大失败判定
  if (roll <= 5) return { success: true, critical: true, roll };
  if (roll >= 96) return { success: false, fumble: true, roll };
  // 普通检定
  return { success: roll <= skillValue, roll };
}
```

### 副本地图系统

```javascript
// 副本地图结构
const dungeonMap = {
  name: "浅层遗迹",
  layers: [
    {
      id: "layer1",
      name: "第1层",
      safehouse: { id: "safehouse_1", name: "第1层安全屋" },
      rooms: [
        { id: "roomA", name: "储藏室", type: "combat", cleared: false },
        { id: "roomB", name: "陷阱走廊", type: "optional", cleared: false, risk: "high" }
      ],
      connections: [
        { from: "safehouse_1", to: "roomA" },
        { from: "safehouse_1", to: "roomB" },
        { from: "roomA", to: "layer2" },
        { from: "roomB", to: "layer2" }
      ]
    },
    {
      id: "layer2",
      name: "第2层",
      safehouse: { id: "safehouse_2", name: "第2层安全屋" },
      rooms: [
        { id: "roomC", name: "仪式厅", type: "boss", cleared: false }
      ],
      connections: [
        { from: "layer1", to: "safehouse_2" },
        { from: "safehouse_2", to: "roomC" }
    }
  ],
  currentLocation: "safehouse_1" // 当前位置
};

// 地图移动
function moveTo(destination) {
  const current = dungeonMap.currentLocation;
  const currentLayer = getCurrentLayer();
  
  // 检查是否可以移动
  const canMove = checkConnection(current, destination);
  if (!canMove) {
    showMessage("无法直接前往该地点");
    return;
  }
  
  // 进入新地点
  if (destination.startsWith("safehouse")) {
    enterSafehouse(destination);
  } else {
    enterRoom(destination);
  }
}

// 渲染地图界面
function renderMap() {
  const currentLayer = getCurrentLayer();
  
  return `
    第${currentLayer.id}层
    ${currentLayer.rooms.map(room => `
      [${room.cleared ? '✓' : room.id === dungeonMap.currentLocation ? '●' : '○'}] ${room.name}
    `).join('')}
    
    ${currentLayer.safehouse.id === dungeonMap.currentLocation ? 
      '当前位置：安全屋（可恢复/撤离）' : 
      '可前往：' + getAvailableDestinations().join(' / ')
    }
  `;
}
```

### 安全屋系统

```javascript
// 安全屋状态
const safehouse = {
  inventory: [], // 共享储藏箱（可选）
  
  // 恢复功能
  rest: {
    hpRecovery: 0.3, // 恢复30% HP
    sanityRecovery: 20, // 恢复20 SAN
    cost: {
      food: 1, // 消耗1食物
      time: 5 // 消耗5分钟（游戏时间）
    }
  },
  
  // 可执行操作
  actions: [
    {
      name: "进食休息",
      condition: (inv) => inv.inventory.food > 0,
      effect: (inv) => {
        inv.hp = Math.min(inv.maxHp, inv.hp + inv.maxHp * 0.3);
        inv.sanity = Math.min(inv.maxSanity, inv.sanity + 20);
        inv.inventory.food--;
        advanceTime(5);
      }
    },
    {
      name: "整理背包",
      effect: () => openInventoryUI()
    },
    {
      name: "查看地图",
      effect: () => showMap()
    },
    {
      name: "前往下一层",
      condition: () => canAdvanceLayer(),
      effect: () => moveToNextLayer()
    },
    {
      name: "撤离副本",
      effect: () => evacuate()
    }
  ]
};

// 撤离系统
function evacuate() {
  // 保存进度
  saveProgress({
    dungeonId: dungeonMap.name,
    clearedRooms: getClearedRooms(),
    inventory: investigator.inventory,
    status: {
      hp: investigator.hp,
      sanity: investigator.sanity
    }
  });
  
  // 结算奖励
  const rewards = calculateRewards();
  showEvacuationSummary(rewards);
  
  // 返回事务所
  returnToOffice();
}
```

### 游戏循环（更新版）

```javascript
function gameLoop() {
  const currentLocation = getCurrentLocation();
  
  // 在安全屋
  if (currentLocation.type === 'safehouse') {
    renderSafehouse();
    waitForSafehouseAction().then(action => {
      if (action === 'enter_room') {
        enterRoom(action.target);
      } else if (action === 'rest') {
        performRest();
      } else if (action === 'evacuate') {
        evacuate();
        return; // 结束游戏循环
      }
    });
  }
  // 在房间内
  else {
    renderRoom();
    waitForObjectSelection().then(selectedObject => {
      showActions(selectedObject);
      waitForActionSelection().then(action => {
        const result = skillCheck(action.skill, action.difficulty);
        applyResult(result, action);
        runObjectAI();
        checkChainReactions();
        
        if (checkRoomComplete()) {
          markRoomCleared();
          showReturnOptions(); // 返回安全屋/继续探索
        }
        
        if (checkGameOver()) return;
        gameLoop();
      });
    });
  }
}
```

---

## 七、测试检查清单

### 功能测试
- [ ] 可以完整通关（3个房间）
- [ ] 可以失败（死亡/时间耗尽/仪式完成）
- [ ] 不同职业有不同体验
- [ ] 对象联动正确触发

### 体验测试
- [ ] 首次玩家能理解"观察→行动"循环
- [ ] 发现对象联动时有"啊哈！"时刻
- [ ] 失败后想再试一次
- [ ] 15-20分钟内完成一局

### 移动端适配
- [ ] 按钮大小适合手指点击（最小44px）
- [ ] 文字在小屏幕上可读
- [ ] 无需横屏（或横竖屏都支持）
- [ ] 加载速度快（3秒内进入游戏）

---

## 八、开发时间表

| 阶段 | 内容 | 时间 |
|-----|------|------|
| ✅ Day 0 | 设计文档+基础框架 | 完成 |
| Day 1 | 地图系统+安全屋系统 | 4小时 |
| Day 2 | 房间系统+回合制核心 | 6小时 |
| Day 3 | 3个房间实现（储藏室/陷阱走廊/仪式厅） | 4小时 |
| Day 4 | 3职业+平衡调整 | 6小时 |
| Day 5 | 测试调试+Bug修复 | 4小时 |
| **总计** | **5天，约24小时** | |

---

## 九、成功后的下一步

如果Demo验证成功：
1. **扩展副本**：从1个副本→3个副本（不同主题）
2. **增加局外**：事务所系统（治疗/训练/招募）
3. **完整文档**：撰写完整设计文档和世界观
4. **美术升级**：专业像素美术
5. **音效添加**：氛围音乐和音效

---

**这个Demo设计文档完整吗？需要调整哪些部分？** 📋

**确认后我立即开始编写代码框架！** 🚀